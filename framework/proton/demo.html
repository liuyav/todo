<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style>
    body {margin: 0; overflow: hidden}
    #testCanvas { background: #000000;}
  </style>

</head>
<body>
  <canvas id="testCanvas"></canvas>
  <script src="js/proton.js"></script>
  <script>
    var canvas;
          var context;
          var proton;
          var renderer;
          var emitter;
          var mouseObj;
          var attractionForce;

          Main();
          function Main() {
            canvas = document.getElementById("testCanvas");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            loadImage();
            mouseObj = {
              x : canvas.width / 2,
              y : canvas.height / 2
            };
          }

          function loadImage() {
            var image = new Image()
            image.onload = function(e) {
              createProton(e.target);
              tick();
              canvas.addEventListener('mousedown', mouseDownHandler, false);
            }
            image.src = 'image/particle.png';
          }

          function createProton(image) {
            proton = new Proton;
            emitter = new Proton.Emitter();

            // 初始化
            emitter.rate = new Proton.Rate(new Proton.Span(35, 55), 2);  // 设置个数，间隔时间
            emitter.addInitialize(new Proton.Mass(10));  // 设置质量
            emitter.addInitialize(new Proton.ImageTarget(image)); // 设置图片
            emitter.addInitialize(new Proton.Position(new Proton.PointZone(canvas.width / 2, canvas.height / 2))); // 设置位置
            emitter.addInitialize(new Proton.Life(1, 1.7)); // 生命周期
            emitter.addInitialize(new Proton.V(new Proton.Span(3, 5), new Proton.Span(0, 360), 'polar')); // 扩散起始点，旋转


            // 添加行为
            emitter.addBehaviour(new Proton.Color('#ff0000', '#ffff00')); // 设置颜色
            attractionForce = new Proton.Attraction(mouseObj, 10, 200); // 设置位置、力度、半径
            emitter.addBehaviour(attractionForce);
            emitter.addBehaviour(new Proton.Scale(Proton.getSpan(1, 1.7), Proton.getSpan(0, .1))); // 设置放大缩小比例
            emitter.addBehaviour(new Proton.Alpha(1, .2));  // 设置透明度
            emitter.emit();
            proton.addEmitter(emitter);


            // 渲染
            renderer = new Proton.Renderer('webgl', proton, canvas);
            renderer.blendFunc("SRC_ALPHA", "ONE");
            renderer.start();
          }

          function mouseDownHandler(e) {
            attractionForce.reset(mouseObj, 0, 200);

            // 点击改变力度
            setTimeout(function() {
              attractionForce.reset(mouseObj, 20, 200);
            }, 500);
          }

          function tick() {
            requestAnimationFrame(tick);
            proton && proton.update();
          }

  </script>
</body>
</html>